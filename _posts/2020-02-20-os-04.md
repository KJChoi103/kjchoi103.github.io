---
layout: post
title:  "인터럽트의 원리"
date:   2020-02-20
desc: "컴퓨터 구조 공부"
keywords: "Computer Structure"
categories: [Os]
tags: [Computer Structure, Operation System]
icon: 
---

# 프로그램 구조와 인터럽트
* 프로그램이 CPU에서 명령을 수행하려면, 주소 영역이 메모리에 올라가 있어야 한다.
* 프로그램의 주소 영역은 크게 코드, 데이터, 스택 영역으로 구분된다.
  * 코드 영역: 우리가 작성한 프로그램 코드들이 기계어 명령으로 변환되어 저장되는 부분.
  * 데이터 영역: 전역변수 등 프로그램이 사용하는 데이터를 저장하는 부분.
  * 스택 영역: 함수가 호출 될 때 호출된 함수의 수행을 마치고 복귀할 주소 및 데이터를 임시로 저장하는 부분
   
* 인터럽트의 동작원리는 함수 호출과 비슷하다.   
  A라는 프로그램이 CPU를 할당받아 명령을 수행하고 있는데, 인터럽트가 발생하면 A는 현재 수행중인 명령어의 위치를 저장한다(PCB에).   
* 운영체제는 현재 실행중인 모든 프로그램을 관리하기 위한 자료구조인 프로세스 제어 블록(PCB, Process Control Block)을 가지고 있다.   
   
---   
   
# 컴퓨터 시스템의 작동
* CPU는 현재 수행해야 할 메모리 주소 명령을 있는 그대로 처리 할 뿐이다.   
  CPU가 수행해야 할 메모리 주소를 담고 있는 레지스터를 Program Counter, PC, 라고 한다.
* CPU가 수행해야 하는 명령어에는 일반명령과 특권명령이 있다.
  - 일반명령: 메모리에서 자료를 읽어와 CPU에서 계산하고 결과를 메모리에 쓰는 일련의 명령들을 말하며 일반명령은 모든 명령어 수행이 가능하다.
  - 특권명령: 보안이 필요한 명령으로 입출력장치, 타이머 등 각종 장치에 접근하는 명령을 말하며 항상 운영체제만 실행가능하다.
   
* 컴퓨터 시스템은 이 두 명령의 실행가능성을 체크하기 위해, CPU에 Mode Bit를 둔다.   
  사용자 프로그램은 디스크 파일에 접근하거나 수행결과를 화면에 출력하는 등의 특권명령을 수행 할 필요가 있을 때, 운영체제에 인터럽트를 걸어서 특권명령을 대행 해 줄 것을 요청한다. 이것을 System Call이라고 한다.   
  사용자 프로그램이 시스템 콜을 하게 되면, 운영체제는 사용자 프로그램의 코드가 아닌 자신의 커널 영역에 정의된 시스템 콜 처리코드를 수행하게 된다.   
   
---   
   
# 프로그램의 실행
* 프로그램이 실행되고 있는 것은 컴퓨터 시스템 차원에서 크게 두 가지 중요한 의미를 가진다.
  * 디스크에 존재하던 실행파일이 메모리에 적재됨.
  * 프로그램이 CPU를 할당받고, 기계명령(instruction)을 수행하고 있는 상태.
* 프로그램의 주소공간 중 당장 필요한 부분은 메모리에 올려놓고, 그렇지 않은 부분은 디스크 중 메모리의 연장공간으로 사용되는 스왑영역에 내려놓는다.
* 프로그램의 주소 공간은 code, data, stack 등으로 구성됨.   
  각각의 프로그램마다 이러한 주소 공간을 별도로 가지며, 각 프로그램마다 독자적으로 존재하는 이와 같은 주소공간을 Virtual Memory(가상메모리) 또는 Logical Memory(논리적 메모리)라고 부른다.   
![운영체제의 주소공간 구조](https://eunhyejung.github.io/assets/contents/content04.PNG)   
* 운영체제도 하나의 프로그램이므로 운영체제 커널 역시 code, data, stack의 주소 공간을 가지고 있다.
  * 커널의 코드는 CPU, 메모리 등의 자원을 관리하기 위한 부분과 사용자에게 편리한 인터페이스를 제공하기 위한 부분이 주를 이루고 있다.   
  그 외에도 커널의 코드는 시스템콜 및 인터럽트를 처리하기 위한 부분도 포함된다.
  * 커널의 데이터 영역에는 각종 자원을 관리하기 위한 자료구조가 저장된다.   
    각 프로세스의 상태, CPU 사용정보, 메모리 사용정보 등을 유지하기 위한 자료구조인 PCB도 커널의 데이터영역에 존재한다.
  * 커널의 스택영역은 함수 호출시의 복귀주소를 저장하기 위한 용도로 사용된다.   
    커널의 스택은 현재 수행중인 프로세스마다 별도의 스택을 두어 관리한다.   
    프로그램이 실행되어 자기 자신의 코드내에서 함수호출 및 복귀주소를 유지하기 위해서는, 자기주소 공간 내의 스택을 활용하고 시스템 콜 등 커널 내의 함수를 호출하는 경우에는 커널의 주소 공간에 존재하는 커널스택을 이용한다.   
   
---   
   
# 사용자 프로그램이 사용하는 함수
  
  
